{"layout":"logicalStructure","root":{"data":{"text":"根节点","expand":true,"isActive":false,"uid":"3d55f05f-7828-43de-97be-c98c07ecd1d3"},"children":[{"data":{"text":"默认值调整：\n1. 还款方式选项默认隐藏\n2. 还款计划选项默认隐藏\n3. hasCategory=true","uid":"cda6cce4-ba11-4ff8-a0df-3720535cd186","expand":true,"richText":false,"isActive":false},"children":[]},{"data":{"text":"created钩子：\n1. 资方是YQH：展示还款方式，隐藏借多久，hasCategory=false（因为有钱花还要选择子资方）\n2. this.$data = localStorage.getItem('adv_borrow_data') // 跳转到其他页面要缓存数据\n3. 调用init()","expand":true,"richText":false,"isActive":false,"uid":"cb5a5e57-e945-458f-b330-de2939d6fdc9"},"children":[]},{"data":{"text":"init函数\n接口：/adv/borrow/goBorrow：\n传参：\nselectCardNumber：localStorage.getItem('') || this.$route.query.cardNumber // 因为智选绑卡支持三方页面\nselectBankCardId：localStorage.getItem('') // 只有自有页面的id才有用，所以不用router\n\n响应：\n1. data.maintainStatus：系统维护中\n2. minAvailableQuota：最小金额、availableQuota：最大可借金额、productName：资方（中文）\n3. data.bankcard：null表示没有银行卡\n4. data.bindBankcardNeedRedirect && data.bindBankcardUrl：绑卡需要跳转三方链接\n5. data.popData：会员弹窗数据\nif(有钱花)：\n    1. data.productInfo：数组集合：repayMethod：还款方式，loanPeriods：期数，rate：利息（只有一个还款方式默认选上）\n    2. 有还款方式，执行handleGetRateAndLoanPeriod(this.productInfo[this.formData.repayMethod])\n    3. 有借款期限，调用handleGetPlanData()，获取借款计划\n    4. hasCategory===true调用协议接口\nelse {\n    执行handleGetRateAndLoanPeriod(data)\n}\n执行handleGetOptions()方法：\n接口：/adv/auth/getPageDiction\n目的：获取贷款用途\nif (选择了期数)：this.handleGetPlanData(money || this.maxAmount)，得到还款计划\n\n6. 自动提交：if (money && this.$route.query.isFinishVideo) onSubmit()","expand":true,"richText":false,"isActive":false,"uid":"0b8daa74-4567-48bd-bd1d-0f8bbca2ea76"},"children":[]},{"data":{"text":"handleGetRateAndLoanPeriod(data, isReset):\n1. 展示利率选项、期数选项\n2. 期数设置options\n3. isReset：修改还款方式，将期数设置为最大值\n调用钩子：init()中选择还款方式、修改还款方式","expand":true,"richText":false,"isActive":false,"uid":"57416f69-cc35-415b-ba6f-23faf2dd9908"},"children":[]},{"data":{"text":"handleGetPlanData()：\n展示还款计划\n接口：/adv/borrow/loanCalculation\n传参：资方，期数，借款金额，还款方式\n\n调用钩子：init()中选择了期数，修改借款金额，修改了期数、修改还款方式","expand":true,"richText":false,"isActive":false,"uid":"28fc9345-9120-4907-9147-e3c620960e50"},"children":[]},{"data":{"text":"事件：修改借款金额onChangeAmount：\n借款期数存在 && handleGetPlanData()","expand":true,"richText":false,"isActive":false,"uid":"845b48d0-80c1-412d-a027-78c95fdbf92e"},"children":[]},{"data":{"text":"事件：修改期数onConfirmPicker：\nhandleGetPlanData()","expand":true,"richText":false,"isActive":false,"uid":"f1a13e6b-eb2b-481c-88e2-596f89ca15f2"},"children":[]},{"data":{"text":"事件：修改还款方式：\n1. 重新获取利率、期数、还款计划handleGetRateAndLoanPeriod、handleGetPlanData","expand":true,"richText":false,"isActive":false,"uid":"4ada691c-339d-4ecb-8d84-e0d92eac10f9"},"children":[]},{"data":{"text":"事件：绑卡\n1. 没有bankcardNumber，所以用bankcardId代替","expand":true,"richText":false,"isActive":false,"uid":"9269cf80-d654-40f6-870f-f83e8ed341fa"},"children":[]},{"data":{"text":"事件：提交\n方法：onSubmit()\n1. 没绑卡先跳绑卡\n2. 校验选项\n3. if (有钱花 & !hasCategory) {\n    // 开始匹配资方\n     return handleGetCategory()\n   3.1：接口：/adv/borrow/match/fund\n       if (data.result === 'WAIT')：展示弹窗，轮询10s，调/adv/borrow/match/result接口，有值执行handleFinishGetCategory(res.data)\n       else if ( data.verifyList)：handleFinishGetCategory(res.data)\n\n    3.2. handleFinishGetCategory(data)\n       handleGetProtocols()：获取协议：接口：/adv/protocol/advProtocolList\n       this.hasCategory = true\n       this.borrowApplyCategoryParams = data.verifyList\n} else {\n    // 真正提交借款\n    4. 是否需要做人脸：if (this.borrowApplyCategoryParams.includes('FACE_CHECK') && !this.$route.query.isFinishVideo) {\n        return switchAction('video', `extraParams=${extra}&next=no`, { product: 'adv' })\n    }\n    5. 调短信验证码：/adv/borrow/sendBorrowSms：判断是否需要输入验证码\n    6. 发送短信验证码：handleApplyBorrow(ob)：接口：/adv/borrow/submitBorrow\n}\n","expand":true,"richText":false,"isActive":false,"uid":"f30ea2d0-9b9a-46c3-9293-551fab91bbae"},"children":[]},{"data":{"text":"YQH第一次提交：匹配资方","expand":true,"richText":false,"isActive":false,"uid":"d14a329c-75c8-4f51-98ed-03d81c619da0"},"children":[{"data":{"text":"事件：提交onSubmit:\n1. handleGetCategory(): 根据接口判断是否需要倒计时\n","uid":"bc2aecbd-e7d6-422d-9259-2d85d6952ded","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[{"data":{"text":"1. 需要倒计时：\n    展示倒计时弹窗：match-loading-dialog.vue，轮询调用/adv/borrow/match/result，res.data.result=true表示有结果，emit('handleFinishGetCategory')回调数据，完成资方匹配\n\n2. 不需要倒计时：完成资方匹配","uid":"3e5eb027-8575-4437-9259-8cffa68b1f11","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]}]}]},{"data":{"text":"YQH同意协议（不能修改任何数据），第二次提交","expand":true,"richText":false,"isActive":false,"uid":"4b61459c-0471-4664-826e-3eaa451efa97"},"children":[{"data":{"text":"事件：提交onSubmit:\n1. 判断this.borrowApplyCategoryParams是否有face_check且route.isFinishVideo=false","uid":"702d68c7-7349-4450-b70c-7818a3328c52","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[{"data":{"text":"是：走人脸。","uid":"7727dd24-4bb7-4bef-8add-f71f64a2b5f9","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[{"data":{"text":"extraParams新增creditH5Url字段，后端判断有creditH5Url直接返回给客户端，客户端再打开新webview跳回到当前页面，route后+了isFinishVideo，走init(money)逻辑","uid":"23096e1c-ca77-450f-ace7-3ad93498bf2e","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]}]},{"data":{"text":"否：请求apiAdvSendBorrowSms接口判断是否需要短信验证，完成借款","expand":true,"richText":false,"isActive":false,"uid":"ca8926f9-b56d-4e25-9271-6830cd3c0ad9","borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]}]}]}]},"theme":{"template":"default","config":{"associativeLineTextFontSize":13,"root":{"fontSize":14},"node":{"fontSize":13},"generalization":{"fontSize":13},"second":{"fontSize":13}}},"view":{"transform":{"scaleX":0.6000000000000001,"scaleY":0.6000000000000001,"shear":0,"rotate":0,"translateX":251.7499999999999,"translateY":613.4999999999995,"originX":0,"originY":0,"a":0.6000000000000001,"b":0,"c":0,"d":0.6000000000000001,"e":251.7499999999999,"f":613.4999999999995},"state":{"scale":0.6000000000000001,"x":251.7499999999999,"y":613.4999999999995,"sx":251.7499999999999,"sy":613.4999999999995}}}