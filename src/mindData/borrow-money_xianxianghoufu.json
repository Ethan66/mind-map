{"layout":"logicalStructure","root":{"data":{"text":"申请借款页","expand":true,"isActive":false,"uid":"fb45168e-b854-4aaf-99a2-6cf0578b5548"},"children":[{"data":{"text":"beforeRouteEnter","uid":"440cc8a0-d6fc-4ee5-89d3-147adcf9c89c","expand":true,"richText":false,"isActive":false},"children":[{"data":{"text":"fromPageStatus属性：\n1. isFromConfirm：from.path == '/borrow/confirm'\n2. finishBorrow：(fromPageStatus.isFromConfirm && from.query.isSubmit) || from.path == '/borrow/result'\n3. hasCache：!(vm.showEnterLoading && fromPageStatus.isFromConfirm) // 确认借款进入客户端人脸，返回reload，数据丢失","uid":"1da96cd1-0901-4797-af1e-253e55afc5cc","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#FA28FF","fillColor":"#fff","borderDasharray":"5,5","lineDasharray":"5,5","lineColor":"#FA28FF"},"children":[]},{"data":{"text":"逻辑1：\nfromPageStatus.finishBorrow == true：回app首页或回上一页\n","expand":true,"richText":false,"isActive":false,"uid":"561428e8-aee3-4f75-8f2e-3e6876254a27","borderWidth":1,"borderColor":"#549688","fillColor":"#fff","icon":[],"generalization":[{"text":"return","range":null,"uid":"2572a389-072d-467d-beb1-2cee086556f7","expand":true,"isActive":false}]},"children":[]},{"data":{"text":"逻辑2：\n1. 判断from.name：\n    1. if (from.name != '协议页、还款计划页、确认借款页') || (缓存数据已被清除)，页面重走handleInitGetInfo()\n    2. else (from.name == '绑卡页面')，调用handleInitGetInfo(true)，获取最新的res.data，其他不走\n    3. from.name == 会员绑卡，重新获取是否有卡，判断宝付支付弹窗的 绑卡有礼 是否显示\n","expand":true,"richText":false,"isActive":false,"uid":"622c3e7a-dde0-4e36-90f6-77ff61ab3a73","borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]},{"data":{"text":"先享后付： \n 1. firstEnjoy.isClickProtocol ==true，从先享后付协议页面回来，展示先享后付弹窗，并将isClickProtocol = false \n 2. firstEnjoy.showConfirmDialog = false // bug修复，从立即借款--先享后付挽留弹窗--放弃，到确认借款页，返回上一页，\n     以上操作重复2次以上后，返回申请借款页莫名弹窗挽留弹窗 \n  3. firstEnjoy.isFinishBind = false // 从确认借款页返回后，再提交，没有开启先享后付，还是要挽留一下","expand":true,"richText":false,"isActive":false,"uid":"4b00150e-69d6-4c23-b863-a29c2ff88c93","borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]}]},{"data":{"text":"主线","expand":true,"richText":false,"isActive":false,"uid":"b6a7c2e3-b81b-453c-9cee-87c1b2e12518"},"children":[{"data":{"text":"handleInitGetInfo (hasCache)\n接口：borrow/getApplyBorrowInfo\n","uid":"0990be05-e1a5-4e39-b342-8bb0fe60fa10","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[{"data":{"text":"hasCache == true：\n  1. this.initData = res.data\n   2. handleSaveCategory(this.initData)","uid":"3e3766cb-73a2-4eb9-8695-daae4b5c87a5","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff","generalization":[{"text":"return","range":null,"uid":"91b77dd6-ab06-4d72-9d44-fc0253caac8a","expand":true,"isActive":false}]},"children":[]},{"data":{"text":"handleSetInterceptBack() // 设置返回拦截\nhandleGetBorrowNperAndUseOptions() // 获取借款期限和借款用途\nhandleInitBorrowNperAndUseValue() // 设置借款期限和借款用途\nhandleCapitalSetBorrowUseValue(this.category) // 特殊资方设置借款期限和借款用途\nhandleGetCurrentMode() // 获取模式：双融担|会员|先享后付\nhandleSetModeStatus(this.currentMode) // 根据模式设置对应状态\nthis.showMember && this.handleMemberGetResource() // 获取会员资源位\n","expand":true,"richText":false,"isActive":false,"uid":"680bc23c-d9d0-4aad-a1ed-6bf9df35e8ef","borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[{"data":{"text":"handleGetCurrentMode()\n接口：/borrow/getFirstApplyInfo\n\nthis.currentMode = res.data.currentMode\nthis.handleFirstEnjoyInit(res.data.payUseInfo) // 初始化先享后付\n\n响应字段：\n  \"currentMode\": 2双融担、1||null正常, \n   \"payUseInfo\": \n      {            \"status\": 运营后台先享后付开关, data.status && !!data.interestImage才是真正的开启\n         \"imageUrl\": \"运营后台先享后付图片配置\",\n         \"interestImage\": \"老后台资源位配置\", \n          \"payCardPrice\": 价格,\n          \"payCardInfo\": \"卡说明\"        }\n","uid":"7269f225-ac29-4cf6-b87a-96e726c6e682","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]},{"data":{"text":"handleSetModeStatus(this.currentMode)\n1. 双融担：可以修改金额；正常模式：默认借款金额是全部，不可修改\n2. showMember状态（是否请求会员的资源位接口）：\n   1. if(双融担)：showMember = !this.firstEnjoy.status（先享后付关闭，展示中间弹窗(易橙卡)，否则不展示）\n   2. else(正常模式)：先享后付开启时，showMember = false","expand":true,"richText":false,"isActive":false,"uid":"76c754b6-5655-4ec5-a5d5-63c689f7195c","borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]}]},{"data":{"text":"code === 1815\n页面：/rollback","expand":true,"richText":false,"isActive":false,"uid":"9e5a7989-470b-4b44-a561-f8c3e357d2ac","borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]}]}]},{"data":{"text":"先享后付","expand":true,"richText":false,"isActive":false,"uid":"99f79983-57b1-4ad6-944d-ab26f0436ecd"},"children":[{"data":{"text":"switch开关关闭：\n1. 请求关闭接口：通知后端用户不要先享后付了\n2. 提交借款：二次挽留弹窗","uid":"0931132b-f2e0-4674-b3bd-bde0dc371994","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]},{"data":{"text":"先享后付绑卡\n申请借款、提交结果、首页进入","expand":true,"richText":false,"isActive":false,"uid":"8e5a2ec2-b530-49ac-82ba-599539c7519d","borderWidth":1,"borderColor":"#549688","fillColor":"#fff","generalization":[{"text":"共用一个弹窗","range":[0,1],"uid":"85b5f155-bcf9-4bac-b8ea-6b4668b31500","expand":true,"isActive":false}]},"children":[{"data":{"text":"申请借款：\n1. props: bankcardNumber、pageType\n2. 请求接口用bankcardNumber\n3. 协议前端写死链接\n4. 埋点：弹窗曝光埋点、提交埋点（用pageType区分）\n5. 提交完成：firstEnjoy.isFinishBind = true; handleApplyMoney()","uid":"de59fcdc-4a08-4f48-a6d9-4b37aa839117","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]},{"data":{"text":"提交结果页：\n1. route.query: borrowNo、pageType\n2. 请求接口用borrowNo，换bankcardNumber\n3. 协议前端写死链接\n4. 埋点：弹窗曝光埋点、提交埋点（用pageType区分）\n5. 提交完成：关闭webview","expand":true,"richText":false,"isActive":false,"uid":"a63cf7a5-4b18-4966-bef7-52b378e7dbae","borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]},{"data":{"text":"首页进入新页面（非弹窗）：\n1. route.query: borrowNo\n2. 请求接口用borrowNo，换bankcardNumber\n3. 协议前端写死链接\n4. 埋点：弹窗曝光埋点、提交埋点（写死）\n5. 提交完成：关闭webview","expand":true,"richText":false,"isActive":false,"uid":"af608bee-5443-4683-91ab-9a320a194b2b","borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]}]},{"data":{"text":"借款结果页的banner\n接口：borrowConfirm/banner\n\n响应字段：\n1. isVip: 是会员 == 不用进排队\n2. isUsePay: 1，先享后付状态开启（等价于运营后台开关开启 && 资源位可见）\n3. bannerList：需要展示的banner图片资源位\n","expand":true,"richText":false,"isActive":false,"uid":"88270a56-8477-40e2-aec3-288c13e1bed0","borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[{"data":{"text":"点击banner：（banner: 先享后付签约成功 | 先享后付购买入口 | 会员购买入口）\n1. 点击埋点区分：购买先享后付和购买会员\n2. 先享后付签约成功banner（isVip）：先享后付购买成功，不触发\n3. 先享后付购买入口banner（isUsePay == 1 & !isVip）：可以购买先享后付，点击去弹窗\n4. 会员购买入口banner（isUsePay == 0 & !isVip）：因为有banner，所以一定是会员购买流程，直接跳链接","uid":"1fa655db-8a81-4859-987c-6aa6b29111c2","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]}]},{"data":{"text":"先享后付后台开关：\n1. 运营后台-系统配置-会员卡快捷支付\n2. 模式：\n   1. 先付后享(金尊卡)（等于借款前置营销页）：杭金投、中原H5、长银H5\n   2. 先享后付(易橙卡)（申请借款页绑卡签约）：杭金投、中原api、长银api\n   3. 金尊卡：锡商网贷（申请借款页从下往上弹Popup）、其他api资方（先享后付不开启，展示中间banner弹窗）\n   4. 杭金投：有先享后付和先付后享模式，所以杭金投的模式是二选一，因为先享后付和先付后享是互斥关系，假如开关状态选择暂停，进入申请维护页\n   5. 小程序：没有会员&&没有先享后付，先享后付通过资源位渠道不可见来控制","expand":true,"richText":false,"isActive":false,"uid":"db92564f-be6d-4510-8d43-8359b44722ac","borderWidth":1,"borderColor":"#333333","fillColor":"#666666","fontWeight":"normal","color":"#FFFFFF"},"children":[]}]},{"data":{"text":"双融担模式","expand":true,"richText":false,"isActive":false,"uid":"f4d7d84f-6207-4cb9-b359-e418dad07165"},"children":[{"data":{"text":"双融担模式：\n1. 资方：中原api，长银api\n2. 双融担和先付后享互斥（不过因为先付后享是营销前置页，不会进入申请借款页，所以没事），和先享后付可共存\n2. resource表里配置：配置关，对应资方直接进入申请维护页","uid":"43782fd8-34a9-44b7-b351-8f93432903c6","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#000000","fillColor":"#666666","color":"#FFFFFF"},"children":[]},{"data":{"text":"分支主题","expand":true,"richText":false,"isActive":false,"uid":"e3f7b07a-42f4-4006-9854-243072e10f29","borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]}]},{"data":{"text":"拦截页","expand":true,"richText":false,"isActive":false,"uid":"25c6cba4-c517-4245-aa39-8a2b05e047be"},"children":[{"data":{"text":"查看结果页(/auth/getAmountFail)\n\n状态：1. 授信被拒 2. 借款被拒 3. 当前资方有在贷\n","uid":"c1e4c956-328f-4f73-a041-42c457451e6b","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[{"data":{"text":"点击button：\n去贷超产品页借款","uid":"ae2896db-cc86-4067-96a7-8ba38db1d56e","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]}]},{"data":{"text":"放款失败页（/borrow/withdraw）\n\n状态：银行放款失败","expand":true,"richText":false,"isActive":false,"uid":"a5c2f183-010e-40fc-8b36-d4e5bdf57562","borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[{"data":{"text":"点击button（/borrow/goBorrowPage接口）：\nres.data.type、res.data.url字段：\n1. type == 1 & url：三方url\n2. type == 2 & url：自有H5\n3. type == 3 & url：原生url\n4. type == 4：回首页\n5. 其他：/borrow/money","uid":"ac7597e8-e793-4939-96ba-bb8ccb063c92","expand":true,"richText":false,"isActive":false,"borderWidth":1,"borderColor":"#549688","fillColor":"#fff"},"children":[]}]}]}]},"theme":{"template":"default","config":{"associativeLineTextFontSize":13,"root":{"fontSize":14},"node":{"fontSize":13},"generalization":{"fontSize":13},"second":{"fontSize":13}}},"view":{"transform":{"scaleX":0.8999999999999999,"scaleY":0.8999999999999999,"shear":0,"rotate":0,"translateX":74.96291208791251,"translateY":-611.6423076923074,"originX":0,"originY":0,"a":0.8999999999999999,"b":0,"c":0,"d":0.8999999999999999,"e":74.96291208791251,"f":-611.6423076923074},"state":{"scale":0.8999999999999999,"x":74.96291208791251,"y":-611.6423076923074,"sx":54.962912087912514,"sy":-368.64230769230744}}}